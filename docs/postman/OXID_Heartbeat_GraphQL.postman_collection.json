{
	"info": {
		"_postman_id": "oxs-heartbeat-graphql",
		"name": "OXID Heartbeat - GraphQL API",
		"description": "GraphQL API Endpoints für das OXID Heartbeat Modul.\n\n## Authentifizierung\n\nDie meisten Endpunkte erfordern eine JWT-Authentifizierung. Verwenden Sie zuerst die OXID GraphQL Base `token`-Query, um ein Token zu erhalten.\n\n## Komponenten\n\n- **ApiUser**: API-Benutzer Setup und Passwort-Verwaltung\n- **RequestLogger**: Steuerung des Request Loggers\n- **LogSender**: Abruf von Log-Dateien vom Shop\n- **DiagnosticsProvider**: Shop-Diagnoseinformationen abrufen",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost.local/graphql",
			"type": "string",
			"description": "Die GraphQL Endpoint URL Ihres OXID Shops"
		},
		{
			"key": "authToken",
			"value": "",
			"type": "string",
			"description": "JWT Token (wird automatisch beim Login gesetzt)"
		},
		{
			"key": "apiUsername",
			"value": "heartbeat-api@oxid-esales.com",
			"type": "string",
			"description": "API-Benutzer E-Mail (Standard: heartbeat-api@oxid-esales.com)"
		},
		{
			"key": "apiPassword",
			"value": "",
			"type": "string",
			"description": "API-Benutzer Passwort"
		},
		{
			"key": "setupToken",
			"value": "",
			"type": "string",
			"description": "Setup-Token aus dem OXID Admin (wird nach Verwendung invalidiert)"
		},
		{
			"key": "newPassword",
			"value": "",
			"type": "string",
			"description": "Neues Passwort für den API-Benutzer (min. 8 Zeichen)"
		}
	],
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{authToken}}",
				"type": "string"
			}
		]
	},
	"item": [
		{
			"name": "Authentication",
			"description": "OXID GraphQL Base Authentifizierung",
			"item": [
				{
					"name": "Get Token (Login)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"if (jsonData.data && jsonData.data.token) {",
									"    pm.collectionVariables.set('authToken', jsonData.data.token);",
									"    console.log('Token saved to collection variable');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query Token($username: String!, $password: String!) {\n    token(username: $username, password: $password)\n}",
								"variables": "{\n    \"username\": \"{{apiUsername}}\",\n    \"password\": \"{{apiPassword}}\"\n}"
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Authentifizierung mit dem Heartbeat API-Benutzer. Das Token wird automatisch in der Collection-Variable gespeichert."
					},
					"response": []
				}
			]
		},
		{
			"name": "ApiUser",
			"description": "API-Benutzer Passwort-Verwaltung\n\n**Hinweis:** `heartbeatSetPassword` erfordert KEINE Authentifizierung, aber einen gültigen Setup-Token.",
			"item": [
				{
					"name": "Set Password (Token-Auth)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var jsonData = pm.response.json();",
									"if (jsonData.data && jsonData.data.heartbeatSetPassword === true) {",
									"    var newPwd = pm.collectionVariables.get('newPassword');",
									"    pm.collectionVariables.set('apiPassword', newPwd);",
									"    pm.collectionVariables.set('setupToken', '');",
									"    console.log('Password set successfully. apiPassword updated, setupToken cleared.');",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "mutation SetPassword($token: String!, $password: String!) {\n    heartbeatSetPassword(token: $token, password: $password)\n}",
								"variables": "{\n    \"token\": \"{{setupToken}}\",\n    \"password\": \"{{newPassword}}\"\n}"
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Setzt das Passwort für den Heartbeat API-Benutzer.\n\n**Voraussetzungen:**\n- Modul muss aktiviert sein\n- Setup-Token muss existieren (wird im Admin generiert)\n\n**Hinweis:** Der Token wird nach erfolgreicher Verwendung invalidiert."
					},
					"response": []
				},
				{
					"name": "Reset Password (Admin-Auth)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "mutation ResetPassword {\n    heartbeatResetPassword\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Setzt das Passwort des API-Benutzers zurück und generiert einen neuen Setup-Token.\n\n**Erfordert:** `OXSHEARTBEAT_PASSWORD_RESET` Berechtigung"
					},
					"response": []
				}
			]
		},
		{
			"name": "RequestLogger",
			"description": "Request Logger Komponente - Einstellungen\n\n**Berechtigungen:**\n- `REQUEST_LOGGER_VIEW` - Einstellungen lesen\n- `REQUEST_LOGGER_CHANGE` - Einstellungen ändern\n\n**Hinweis:** Die Komponente kann nur im Admin aktiviert/deaktiviert werden.",
			"item": [
				{
					"name": "Get All Settings",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query GetAllSettings {\n    requestLoggerSettings {\n        name\n        type\n        supported\n    }\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Gibt alle Request Logger Einstellungen mit Namen und Typ zurück.\n\n**Erfordert:** `REQUEST_LOGGER_VIEW`"
					},
					"response": []
				},
				{
					"name": "Get Log Level",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query GetLogLevel {\n    requestLoggerLogLevel\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Gibt das aktuelle Log-Level zurück.\n\n**Erfordert:** `REQUEST_LOGGER_VIEW`"
					},
					"response": []
				},
				{
					"name": "Change Log Level",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "mutation ChangeLogLevel($value: String!) {\n    requestLoggerLogLevelChange(value: $value)\n}",
								"variables": "{\n    \"value\": \"detailed\"\n}"
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Ändert das Log-Level.\n\n**Gültige Werte:** 'standard', 'detailed'\n\n**Erfordert:** `REQUEST_LOGGER_CHANGE`"
					},
					"response": []
				},
				{
					"name": "Get Log Frontend",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query GetLogFrontend {\n    requestLoggerLogFrontend\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Prüft, ob Frontend-Requests geloggt werden.\n\n**Erfordert:** `REQUEST_LOGGER_VIEW`"
					},
					"response": []
				},
				{
					"name": "Change Log Frontend",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "mutation ChangeLogFrontend($value: Boolean!) {\n    requestLoggerLogFrontendChange(value: $value)\n}",
								"variables": "{\n    \"value\": true\n}"
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Aktiviert/Deaktiviert das Logging von Frontend-Requests.\n\n**Erfordert:** `REQUEST_LOGGER_CHANGE`"
					},
					"response": []
				},
				{
					"name": "Get Log Admin",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query GetLogAdmin {\n    requestLoggerLogAdmin\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Prüft, ob Admin-Requests geloggt werden.\n\n**Erfordert:** `REQUEST_LOGGER_VIEW`"
					},
					"response": []
				},
				{
					"name": "Change Log Admin",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "mutation ChangeLogAdmin($value: Boolean!) {\n    requestLoggerLogAdminChange(value: $value)\n}",
								"variables": "{\n    \"value\": false\n}"
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Aktiviert/Deaktiviert das Logging von Admin-Requests.\n\n**Erfordert:** `REQUEST_LOGGER_CHANGE`"
					},
					"response": []
				},
				{
					"name": "Get Redact Items",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query GetRedactItems {\n    requestLoggerRedact\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Gibt die Liste der zu schwärzenden Felder als JSON-Array zurück.\n\n**Erfordert:** `REQUEST_LOGGER_VIEW`"
					},
					"response": []
				},
				{
					"name": "Change Redact Items",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "mutation ChangeRedactItems($value: String!) {\n    requestLoggerRedactChange(value: $value)\n}",
								"variables": "{\n    \"value\": \"[\\\"password\\\", \\\"creditcard\\\", \\\"cvv\\\"]\"\n}"
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Setzt die Liste der zu schwärzenden Felder.\n\n**Format:** JSON-Array als String\n\n**Erfordert:** `REQUEST_LOGGER_CHANGE`"
					},
					"response": []
				},
				{
					"name": "Get Redact All Values",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query GetRedactAllValues {\n    requestLoggerRedactAllValues\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Prüft, ob alle Werte geschwärzt werden.\n\n**Erfordert:** `REQUEST_LOGGER_VIEW`"
					},
					"response": []
				},
				{
					"name": "Change Redact All Values",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "mutation ChangeRedactAllValues($value: Boolean!) {\n    requestLoggerRedactAllValuesChange(value: $value)\n}",
								"variables": "{\n    \"value\": false\n}"
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Aktiviert/Deaktiviert das Schwärzen aller Werte.\n\n**Erfordert:** `REQUEST_LOGGER_CHANGE`"
					},
					"response": []
				}
			]
		},
		{
			"name": "LogSender",
			"description": "Log Sender Komponente - Abruf von Log-Dateien\n\n**Voraussetzungen:**\n- Log Sender Komponente muss aktiviert sein\n- Log-Quellen müssen im Admin aktiviert sein\n\n**Erfordert:** `LOG_SENDER_VIEW` Berechtigung",
			"item": [
				{
					"name": "Get All Enabled Sources",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query LogSenderSources {\n    logSenderSources {\n        id\n        name\n        description\n        origin\n        available\n        paths {\n            path\n            type\n            name\n            description\n            exists\n            readable\n        }\n    }\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Gibt alle aktivierten Log-Quellen zurück.\n\n**Erfordert:** `LOG_SENDER_VIEW`"
					},
					"response": []
				},
				{
					"name": "Get Source Content",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query LogSenderContent($sourceId: String!, $maxBytes: Int) {\n    logSenderContent(sourceId: $sourceId, maxBytes: $maxBytes) {\n        sourceId\n        sourceName\n        path\n        content\n        size\n        modified\n        truncated\n    }\n}",
								"variables": "{\n    \"sourceId\": \"oxid_core\",\n    \"maxBytes\": 1048576\n}"
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Gibt den Inhalt einer bestimmten Log-Quelle zurück.\n\n**Parameter:**\n- sourceId: Die ID der Log-Quelle\n- maxBytes: Optionale maximale Bytes\n\n**Erfordert:** `LOG_SENDER_VIEW`"
					},
					"response": []
				}
			]
		},
		{
			"name": "DiagnosticsProvider",
			"description": "Diagnostics Provider Komponente - Shop-Diagnoseinformationen\n\n**Voraussetzungen:**\n- Diagnostics Provider Komponente muss aktiviert sein\n- API User muss eingerichtet sein\n\n**Erfordert:** `LOG_SENDER_VIEW` Berechtigung",
			"item": [
				{
					"name": "Get Diagnostics",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query Diagnostics {\n    diagnostics {\n        phpDecoder\n        sections {\n            name\n            items {\n                key\n                value\n            }\n        }\n    }\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Gibt umfassende Diagnoseinformationen über den Shop zurück.\n\n**Rückgabe:**\n- `phpDecoder`: PHP-Decoder Information\n- `sections`: Shop Details, Module List, System Info, PHP Config, Server Info\n\n**Erfordert:** `LOG_SENDER_VIEW`"
					},
					"response": []
				},
				{
					"name": "Get Diagnostics (Minimal)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "graphql",
							"graphql": {
								"query": "query DiagnosticsMinimal {\n    diagnostics {\n        phpDecoder\n        sections {\n            name\n        }\n    }\n}",
								"variables": ""
							}
						},
						"url": {
							"raw": "{{baseUrl}}",
							"host": [
								"{{baseUrl}}"
							]
						},
						"description": "Gibt eine minimale Übersicht der verfügbaren Diagnose-Sections zurück.\n\n**Erfordert:** `LOG_SENDER_VIEW`"
					},
					"response": []
				}
			]
		}
	]
}
